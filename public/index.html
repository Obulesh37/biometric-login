<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fingerprint Login</title>
  <style>
    body { font-family: system-ui; background: linear-gradient(135deg, #667eea, #764ba2); min-height: 100vh; margin: 0; display: flex; align-items: center; justify-content: center; }
    .card { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); max-width: 400px; width: 90%; text-align: center; }
    input { width: 100%; padding: 14px; margin: 12px 0; border: 1px solid #ddd; border-radius: 12px; font-size: 16px; }
    button { width: 100%; padding: 16px; margin: 20px 0 10px; background: #667eea; color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; }
    .status { padding: 12px; border-radius: 12px; margin: 15px 0; font-weight: bold; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .hidden { display: none; }
    a { color: #667eea; font-size: 14px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Fingerprint Login</h1>
    <p>Touch ID • Face ID • Windows Hello</p>

    <div id="welcome" class="hidden">
      <h2>Welcome,<br><span id="name" style="color:#667eea"></span>!</h2>
      <p id="email"></p>
      <button onclick="location.reload()">Logout</button>
    </div>

    <div id="register">
      <input type="text" id="regName" placeholder="Full Name" />
      <input type="email" id="regEmail" placeholder="you@gmail.com" />
      <button onclick="register()">Register with Biometric</button>
      <p><a href="#" onclick="showLogin(event)">Already registered?</a></p>
    </div>

    <div id="login" class="hidden">
      <input type="email" id="loginEmail" placeholder="you@gmail.com" />
      <button onclick="login()">Login with Biometric</button>
      <p><a href="#" onclick="showRegister(event)">New user?</a></p>
    </div>

    <div id="status" class="status success">Ready</div>
  </div>

  <script>
    const API = '';
    const status = document.getElementById('status');

    function setStatus(msg, error = false) {
      status.textContent = msg;
      status.className = error ? 'status error' : 'status success';
    }

    function showLogin(e) { e?.preventDefault(); document.getElementById('login').classList.remove('hidden'); document.getElementById('register').classList.add('hidden'); document.getElementById('welcome').classList.add('hidden'); }
    function showRegister(e) { e?.preventDefault(); document.getElementById('register').classList.remove('hidden'); document.getElementById('login').classList.add('hidden'); document.getElementById('welcome').classList.add('hidden'); }

    async function register() {
      const name = document.getElementById('regName').value.trim();
      const email = document.getElementById('regEmail').value.trim();
      if (!name || !email) return setStatus('Fill all fields', true);

      setStatus('Touch your sensor...');
      const res = await fetch(`${API}/register/request`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({name, email}) });
      const opts = await res.json();

      opts.challenge = fromBase64Url(opts.challenge);
      opts.user.id = fromBase64Url(opts.user.id);

      const cred = await navigator.credentials.create({ publicKey: opts });
      await fetch(`${API}/register/response`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ sessionId: opts.sessionId, credential: cred }) });

      setStatus('Registered! Now login');
      showLogin();
      document.getElementById('loginEmail').value = email;
    }

    async function login() {
      const email = document.getElementById('loginEmail').value.trim();
      if (!email) return setStatus('Enter email', true);

      setStatus('Touch your sensor...');
      const res = await fetch(`${API}/login/request`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({email}) });
      if (!res.ok) return setStatus('No account found', true);
      const opts = await res.json();

      opts.challenge = fromBase64Url(opts.challenge);
      opts.allowCredentials[0].id = fromBase64Url(opts.allowCredentials[0].id);

      const assertion = await navigator.credentials.get({ publicKey: opts });
      const result = await fetch(`${API}/login/response`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ sessionId: opts.sessionId, assertion }) });
      const data = await result.json();

      if (data.success) {
        document.getElementById('name').textContent = data.user.name;
        document.getElementById('email').textContent = data.user.email;
        document.getElementById('welcome').classList.remove('hidden');
        document.getElementById('login').classList.add('hidden');
        setStatus('Welcome back!');
      } else {
        setStatus(data.error || 'Login failed', true);
      }
    }

    function fromBase64Url(str) {
      const padding = '==='.slice(0, (4 - str.length % 4) % 4);
      return Uint8Array.from(atob(str.replace(/-/g, '+').replace(/_/g, '/') + padding), c => c.charCodeAt(0));
    }
  </script>
</body>
</html>